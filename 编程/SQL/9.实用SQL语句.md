# ğŸŒ»å®ç”¨SQLè¯­å¥

åœ¨ç¼–å†™SQLæ—¶ï¼Œçµæ´»è¿ç”¨ä¸€äº›æŠ€å·§ï¼Œå¯ä»¥å¤§å¤§ç®€åŒ–ç¨‹åºé€»è¾‘ã€‚


### 1. æ’å…¥æˆ–æ›¿æ¢
å¦‚æœæˆ‘ä»¬å¸Œæœ›æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼ˆINSERTï¼‰ï¼Œä½†å¦‚æœè®°å½•å·²ç»å­˜åœ¨ï¼Œå°±å…ˆåˆ é™¤åŸè®°å½•ï¼Œå†æ’å…¥æ–°è®°å½•ã€‚æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`REPLACE`è¯­å¥ï¼Œè¿™æ ·å°±ä¸å¿…å…ˆæŸ¥è¯¢ï¼Œå†å†³å®šæ˜¯å¦å…ˆåˆ é™¤å†æ’å…¥ï¼š
```
REPLACE INTO students (id, class_id, name, gender, score) VALUES (1, 1, 'å°æ˜', 'F', 99);
```
è‹¥`id=1`çš„è®°å½•ä¸å­˜åœ¨ï¼Œ`REPLACE`è¯­å¥å°†æ’å…¥æ–°è®°å½•ï¼Œå¦åˆ™ï¼Œå½“å‰`id=1`çš„è®°å½•å°†è¢«åˆ é™¤ï¼Œç„¶åå†æ’å…¥æ–°è®°å½•ã€‚
### 2. æ’å…¥æˆ–æ›´æ–°
å¦‚æœæˆ‘ä»¬å¸Œæœ›æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼ˆINSERTï¼‰ï¼Œä½†å¦‚æœè®°å½•å·²ç»å­˜åœ¨ï¼Œå°±æ›´æ–°è¯¥è®°å½•ï¼Œæ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`INSERT INTO ... ON DUPLICATE KEY UPDATE ...`è¯­å¥ï¼š
```
INSERT INTO students (id, class_id, name, gender, score) VALUES (1, 1, 'å°æ˜', 'F', 99) ON DUPLICATE KEY UPDATE name='å°æ˜', gender='F', score=99;
```
è‹¥`id=1`çš„è®°å½•ä¸å­˜åœ¨ï¼Œ`INSERT`è¯­å¥å°†æ’å…¥æ–°è®°å½•ï¼Œå¦åˆ™ï¼Œå½“å‰`id=1`çš„è®°å½•å°†è¢«æ›´æ–°ï¼Œæ›´æ–°çš„å­—æ®µç”±`UPDATE`æŒ‡å®šã€‚
### æ’å…¥æˆ–å¿½ç•¥
å¦‚æœæˆ‘ä»¬å¸Œæœ›æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼ˆINSERTï¼‰ï¼Œä½†å¦‚æœè®°å½•å·²ç»å­˜åœ¨ï¼Œå°±å•¥äº‹ä¹Ÿä¸å¹²ç›´æ¥å¿½ç•¥ï¼Œæ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`INSERT IGNORE INTO ...`è¯­å¥ï¼š
```
INSERT IGNORE INTO students (id, class_id, name, gender, score) VALUES (1, 1, 'å°æ˜', 'F', 99);
```
è‹¥`id=1`çš„è®°å½•ä¸å­˜åœ¨ï¼Œ`INSERT`è¯­å¥å°†æ’å…¥æ–°è®°å½•ï¼Œå¦åˆ™ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚
### å¿«ç…§
å¦‚æœæƒ³è¦å¯¹ä¸€ä¸ªè¡¨è¿›è¡Œå¿«ç…§ï¼Œå³å¤åˆ¶ä¸€ä»½å½“å‰è¡¨çš„æ•°æ®åˆ°ä¸€ä¸ªæ–°è¡¨ï¼Œå¯ä»¥ç»“åˆ`CREATE TABLE`å’Œ`SELECT`ï¼š
```
-- å¯¹class_id=1çš„è®°å½•è¿›è¡Œå¿«ç…§ï¼Œå¹¶å­˜å‚¨ä¸ºæ–°è¡¨students_of_class1:
CREATE TABLE students_of_class1 SELECT * FROM students WHERE class_id=1;
```
æ–°åˆ›å»ºçš„è¡¨ç»“æ„å’Œ`SELECT`ä½¿ç”¨çš„è¡¨ç»“æ„å®Œå…¨ä¸€è‡´ã€‚
### å†™å…¥æŸ¥è¯¢ç»“æœé›†
å¦‚æœæŸ¥è¯¢ç»“æœé›†éœ€è¦å†™å…¥åˆ°è¡¨ä¸­ï¼Œå¯ä»¥ç»“åˆ`INSERT`å’Œ`SELECT`ï¼Œå°†`SELECT`è¯­å¥çš„ç»“æœé›†ç›´æ¥æ’å…¥åˆ°æŒ‡å®šè¡¨ä¸­ã€‚
ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªç»Ÿè®¡æˆç»©çš„è¡¨`statistics`ï¼Œè®°å½•å„ç­çš„å¹³å‡æˆç»©ï¼š
```sql
CREATE TABLE statistics (
    id BIGINT NOT NULL AUTO_INCREMENT,
    class_id BIGINT NOT NULL,
    average DOUBLE NOT NULL,
    PRIMARY KEY (id)
);
```
ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸€æ¡è¯­å¥å†™å…¥å„ç­çš„å¹³å‡æˆç»©ï¼š
```
INSERT INTO statistics (class_id, average) SELECT class_id, AVG(score) FROM students GROUP BY class_id;
```
ç¡®ä¿`INSERT`è¯­å¥çš„åˆ—å’Œ`SELECT`è¯­å¥çš„åˆ—èƒ½ä¸€ä¸€å¯¹åº”ï¼Œå°±å¯ä»¥åœ¨`statistics`è¡¨ä¸­ç›´æ¥ä¿å­˜æŸ¥è¯¢çš„ç»“æœï¼š
```
> SELECT * FROM statistics;
+----+----------+--------------+
| id | class_id | average      |
+----+----------+--------------+
|  1 |        1 |         86.5 |
|  2 |        2 | 73.666666666 |
|  3 |        3 | 88.333333333 |
+----+----------+--------------+
3 rows in set (0.00 sec)
```
### å¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç´¢å¼•
åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œæ•°æ®åº“ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†ææŸ¥è¯¢è¯­å¥ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªæœ€åˆé€‚çš„ç´¢å¼•ã€‚ä½†æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œæ•°æ®åº“ç³»ç»Ÿçš„æŸ¥è¯¢ä¼˜åŒ–å™¨å¹¶ä¸ä¸€å®šæ€»æ˜¯èƒ½ä½¿ç”¨æœ€ä¼˜ç´¢å¼•ã€‚å¦‚æœæˆ‘ä»¬çŸ¥é“å¦‚ä½•é€‰æ‹©ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨`FORCE INDEX`å¼ºåˆ¶æŸ¥è¯¢ä½¿ç”¨æŒ‡å®šçš„ç´¢å¼•ã€‚ä¾‹å¦‚ï¼š
```
> SELECT * FROM students FORCE INDEX (idx_class_id) WHERE class_id = 1 ORDER BY id DESC;
```
æŒ‡å®šç´¢å¼•çš„å‰ææ˜¯ç´¢å¼•`idx_class_id`å¿…é¡»å­˜åœ¨ã€‚
